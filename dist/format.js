window.storyFormat({
  "name": "Twison",
  "version": "0.0.1",
  "author": "Mike Lazer-Walker",
  "description": "Export your Twine 2 story as a JSON document",
  "proofing": false,
  "source": "<html>\r\n\t<head>\r\n\t\t<title>{{STORY_NAME}}</title>\r\n\t\t<script type=\"text/javascript\">\r\n/**\r\n * Twison - Twine 2 JSON Export Story Format\r\n * \r\n * Copyright (c) 2015 Mike Walker\r\n * https://lazerwalker.com\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and\r\n * associated documentation files (the \"Software\"), to deal in the Software without restriction,\r\n * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\r\n * subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all copies or substantial\r\n * portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\r\n * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\r\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n */\r\nconst choiceRegexp=/\\[\\[.+?\\]\\]/g,choiceSyntaxRegExp=/\\[\\[(.*?)\\-\\&gt;(.*?)\\]\\]/;var Twison={extractLinksFromText:function(t){var n=t.match(choiceRegexp);if(n)return n.map((function(t){var n=t.match(choiceSyntaxRegExp);return n?{name:n[1],link:n[2]}:(t=t.substring(2,t.length-2),console.log(\"Direct Link\",t),{name:t,link:t})}))},filterText:function(t){let n=t;const e=t.match(choiceRegexp);return e&&e.forEach(t=>{n=n.replace(t,\"\")}),n.endsWith(\"\\n\")&&(n=n.split(\" \").filter((t,n,e)=>n!==e.length-1).join(\" \")),n.trim()},arrangeKeys:function(t){const n={};return[\"pid\",\"name\",\"text\",\"tags\",\"auto_link\",\"links\"].forEach(e=>{t[e]&&(n[e]=t[e])}),n},convertPassage:function(t){var n=t.innerHTML;const e={};var a=n.match(choiceRegexp);a&&(e.links=a.filter(t=>!!t.match(choiceSyntaxRegExp)||(e.auto_link=t.substring(2,t.length-2),!1)).map(t=>{const n=t.match(choiceSyntaxRegExp);return{name:n[1],link:n[2]}})),e.links&&e.links.length||delete e.links;return[\"name\",\"pid\",\"position\",\"tags\"].forEach(n=>{const a=t.attributes[n].value;a&&(e[n]=a)}),e.tags&&(e.tags=e.tags.split(\" \")),e.text=Twison.filterText(n),Twison.arrangeKeys(e)},convertStory:function(t){var n=t.getElementsByTagName(\"tw-passagedata\"),e={passages:Array.prototype.slice.call(n).map(Twison.convertPassage)};[\"name\",\"startnode\",\"ifid\"].forEach((function(n){var a=t.attributes[n].value;a&&(e[n]=a)}));var a={};return e.passages.forEach(t=>{a[t.name]=t.pid}),e.passages.forEach(t=>{t.auto_link&&(t.auto_link=a[t.auto_link]),t.links&&t.links.forEach((function(t){t.pid=a[t.link],t.pid||(t.broken=!0)}))}),e.visited=!1,e},convert:function(){var t=document.getElementsByTagName(\"tw-storydata\")[0],n=JSON.stringify(Twison.convertStory(t),null,2);document.getElementById(\"output\").innerHTML=n}};window.Twison=Twison;\t\t\r\n\t\t</script>\r\n\t</head>\r\n\t<body>\r\n\t\t<pre id=\"output\">\r\n\t\t\r\n\t\t</pre>\r\n\t\t<div id=\"storyData\" style=\"display: none;\">\r\n\t\t\t{{STORY_DATA}}\r\n\t\t</div>\r\n\t\t<script>\r\n\t\t\tTwison.convert()\r\n\t\t</script>\r\n\t</body>\r\n</html>"
});